<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revelo - Media Management</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Nunito -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">

    <!-- Your Custom Stylesheet -->
    <link rel="stylesheet" href="style.css">

</head>
<body class="bg-gray-100 antialiased text-gray-800 pt-8" data-page-type="media-management">
    <!-- Organizer-specific Navbar -->
    <div id="organizer-navbar-placeholder"></div>

    <!-- Main container -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Header Section from Event Management Dashboard -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-6">
            <div>
                <div class="flex items-center">
                    <h1 class="text-3xl font-extrabold revelo-blue">Sensuality & Essentiality</h1>
                    <span class="ml-4 text-sm font-bold bg-green-100 text-green-800 px-3 py-1 rounded-full whitespace-nowrap">On Sale</span>
                </div>
                <p class="text-gray-600">Media Management Dashboard</p>
            </div>
            <div class="flex space-x-2 mt-4 md:mt-0">
                <a href="eventDetailOrganizerView.html" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition duration-300">View Public Page</a>
                <a href="liveEventEdit.html" class="px-4 py-2 bg-revelo-blue text-white rounded-lg hover:bg-blue-800 transition duration-300">Live Edit Page</a>
            </div>
        </header>

        <!-- This is a temporary wrapper for previewing the tab content -->
        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            <main class="p-6 md:p-8">

                <!-- START OF MEDIA GALLERY TAB CONTENT -->
                <div id="media">
                    <!-- The original header was here and has been removed. -->

                    <!-- Two-Panel Layout -->
                    <div class="flex flex-col md:flex-row md:space-x-8">
                        <!-- Left Sidebar: Tree View -->
                        <aside class="w-full md:w-1/4 lg:w-1/5 border rounded-lg p-4 bg-gray-50 mb-6 md:mb-0">
                            <h3 class="font-bold revelo-blue mb-2">Gallery Folders</h3>
                            <ul id="gallery-tree" class="space-y-1">
                                <!-- Tree items will be generated by JS -->
                            </ul>
                        </aside>

                        <!-- Right Panel: Grid View -->
                        <div class="flex-1">
                            <!-- Breadcrumb Navigation -->
                            <nav id="breadcrumb-nav" class="mb-4 text-sm text-gray-500"></nav>

                            <!-- Current Folder Actions -->
                            <div id="current-folder-actions" class="mb-6 p-4 border rounded-lg bg-gray-50">
                                <!-- Folder info will be generated by JS -->
                            </div>
                            
                            <!-- Gallery Grid -->
                            <div id="gallery-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                                <!-- Gallery cards will be generated by JS -->
                            </div>
                        </div>
                    </div>
                </div>
                <!-- END OF MEDIA GALLERY TAB CONTENT -->

            </main>
        </div>
    </div>
    
    <!-- Edit Folder Modal -->
    <div id="modal-backdrop" class="fixed inset-0 bg-black bg-opacity-50 hidden z-40"></div>
    <div id="edit-folder-modal" class="modal fixed inset-0 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-lg p-6 space-y-4">
            <h3 class="font-bold text-xl revelo-blue" id="modal-folder-name">Edit Folder: Official Media</h3>
            <!-- Owner Badge -->
            <div id="modal-owner-badge" class="flex items-center text-sm font-semibold revelo-blue p-2 bg-blue-50 rounded-lg">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                <span id="modal-owner-name">Folder Owner: AMedia</span>
            </div>
            <!-- Copy link -->
            <div class="flex items-center justify-between border-t py-4">
                <div class="flex items-center space-x-2 text-revelo-blue font-semibold cursor-pointer">
                    <!-- New SVG for the link icon -->
                    <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor"><path d="M451.5 160C434.9 160 418.8 164.5 404.7 172.7C388.9 156.7 370.5 143.3 350.2 133.2C378.4 109.2 414.3 96 451.5 96C537.9 96 608 166 608 252.5C608 294 591.5 333.8 562.2 363.1L491.1 434.2C461.8 463.5 422 480 380.5 480C294.1 480 224 410 224 323.5C224 322 224 320.5 224.1 319C224.6 301.3 239.3 287.4 257 287.9C274.7 288.4 288.6 303.1 288.1 320.8C288.1 321.7 288.1 322.6 288.1 323.4C288.1 374.5 329.5 415.9 380.6 415.9C405.1 415.9 428.6 406.2 446 388.8L517.1 317.7C534.4 300.4 544.2 276.8 544.2 252.3C544.2 201.2 502.8 159.8 451.7 159.8zM307.2 237.3C305.3 236.5 303.4 235.4 301.7 234.2C289.1 227.7 274.7 224 259.6 224C235.1 224 211.6 233.7 194.2 251.1L123.1 322.2C105.8 339.5 96 363.1 96 387.6C96 438.7 137.4 480.1 188.5 480.1C205 480.1 221.1 475.7 235.2 467.5C251 483.5 269.4 496.9 289.8 507C261.6 530.9 225.8 544.2 188.5 544.2C102.1 544.2 32 474.2 32 387.7C32 346.2 48.5 306.4 77.8 277.1L148.9 206C178.2 176.7 218 160.2 259.5 160.2C346.1 160.2 416 230.8 416 317.1C416 318.4 416 319.7 416 321C415.6 338.7 400.9 352.6 383.2 352.2C365.5 351.8 351.6 337.1 352 319.4C352 318.6 352 317.9 352 317.1C352 283.4 334 253.8 307.2 237.5z"/></svg>
                    <span>Copy folder link</span>
                </div>
            </div>
            <!-- Status -->
            <div>
                <label class="font-semibold text-gray-700">Status</label>
                <select id="modal-folder-status" onchange="toggleScheduledFields(); toggleVisibilityControl()" class="w-full p-2 border border-gray-300 rounded-md mt-1">
                    <option>Private</option>
                    <option>Public</option>
                    <option>Scheduled</option>
                </select>
            </div>
            <!-- Gallery visibility control -->
            <div id="visibility-control-container" class="space-y-2 hidden">
                <label class="font-semibold text-gray-700">Gallery visibility</label>
                <select id="modal-visibility-control" class="w-full p-2 border border-gray-300 rounded-md mt-1">
                    <option>Restricted (only owner and collaborators)</option>
                    <option>Anyone with the link</option>
                </select>
            </div>
            <!-- Scheduled Fields -->
            <div id="modal-scheduled-fields" class="hidden grid grid-cols-2 gap-4">
                <div>
                    <label class="font-semibold text-gray-700">Publish Date</label>
                    <input type="date" class="w-full p-2 border border-gray-300 rounded-md mt-1">
                </div>
                <div>
                    <label class="font-semibold text-gray-700">Publish Time</label>
                    <input type="time" class="w-full p-2 border border-gray-300 rounded-md mt-1">
                </div>
            </div>
            <!-- Collaborators -->
            <div>
                <label class="font-semibold text-gray-700">Collaborators</label>
                <div id="modal-collaborators-list" class="flex flex-wrap gap-2 mt-2">
                    <!-- Collaborator tags will be added here -->
                </div>
                <div class="relative mt-2">
                    <input type="text" id="modal-collaborator-search" onkeyup="handleModalSearch(event)" placeholder="Search to add a media creator..." class="w-full p-2 border border-gray-300 rounded-md">
                    <div id="modal-search-suggestions" class="absolute w-full bg-white border border-gray-300 rounded-md mt-1 shadow-lg z-20 hidden"></div>
                </div>
            </div>
            <div class="flex justify-end space-x-2 border-t pt-4">
                <button onclick="closeAllModals()" class="px-4 py-2 font-semibold bg-gray-200 text-gray-700 rounded-lg">Cancel</button>
                <button onclick="alert('Simulating: Folder Saved!'); closeAllModals();" class="px-4 py-2 font-bold bg-revelo-blue text-white rounded-lg">Save Changes</button>
            </div>
        </div>
    </div>
    
    <!-- Media Modal -->
    <div id="media-modal" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-4 hidden z-[100]">
        <!-- Image Display Area -->
        <div class="relative w-full h-full flex items-center justify-center">
            <img id="modal-image" src="" class="max-h-full max-w-full object-contain cursor-pointer">
            
            <!-- Overlay Container -->
            <div id="modal-overlay" class="absolute inset-0 flex flex-col justify-between p-2">
                <!-- Modal Header -->
                <div class="w-full flex justify-between items-start text-white">
                    <div>
                        <h3 id="modal-event-name" class="font-bold text-lg"></h3>
                        <p id="modal-creator-name" class="text-sm"></p>
                    </div>
                    <div id="modal-header-icons" class="flex items-center space-x-2">
                        <!-- Icons will be dynamically loaded by JS -->
                    </div>
                </div>
                <!-- Navigation -->
                <div id="modal-nav" class="w-full flex justify-between items-center absolute top-1/2 left-0 transform -translate-y-1/2">
                     <button id="prev-media" class="text-white bg-black bg-opacity-30 p-3 rounded-full m-2 hover:bg-opacity-50 transition-opacity"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button>
                     <button id="next-media" class="text-white bg-black bg-opacity-30 p-3 rounded-full m-2 hover:bg-opacity-50 transition-opacity"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- This is the main script for the page's core functionality -->
    <script>
        // Updated galleryData with new folders and properties
        const galleryData = {
            id: 'root',
            name: 'Root',
            children: [
                {
                    id: 'sensuality',
                    name: 'Official Media',
                    status: 'Public',
                    owner: 'AMedia', // Added owner property
                    creators: [{ name: 'AMedia', avatar: 'https://placehold.co/80x80/f58220/ffffff?text=A' }],
                    children: [
                        {
                            id: 'sat',
                            name: 'Saturday 01-Nov',
                            status: 'Public',
                            owner: 'AMedia',
                            creators: [{ name: 'AMedia', avatar: 'https://placehold.co/80x80/f58220/ffffff?text=A' }],
                            children: [
                                { id: 'Social', name: 'Social', type: 'gallery', status: 'Public', owner: 'AMedia', creators: [{ name: 'AMedia', avatar: 'https://placehold.co/80x80/f58220/ffffff?text=A' }, { name: 'Lutty Moreira', avatar: 'https://placehold.co/80x80/f58220/ffffff?text=LM' }], content: '125 Photos, 10 Videos' },
                                { id: 'jandj', name: 'Jack & Jill', type: 'gallery', status: 'Public', owner: 'AMedia', creators: [{ name: 'AMedia', avatar: 'https://placehold.co/80x80/f58220/ffffff?text=A' }], content: '50 Photos' },
                            ]
                        },
                        // Moved 'sun' folder to be a child of 'sensuality'
                        {
                            id: 'sun',
                            name: 'Sunday 02-Nov',
                            status: 'Scheduled',
                            schedule: 'Nov 10, 2025 10:00 AM',
                            owner: 'AMedia',
                            creators: [{ name: 'AMedia', avatar: 'https://placehold.co/80x80/f58220/ffffff?text=A' }],
                            children: [
                                { id: 'sun-photos', name: 'Photos', status: 'Scheduled', schedule: 'Nov 10, 2025 10:00 AM', owner: 'AMedia', creators: [{ name: 'AMedia', avatar: 'https://placehold.co/80x80/f58220/ffffff?text=A' }], children: [
                                    { id: 'sun-social', name: 'Sunday Social', type: 'gallery', status: 'Scheduled', owner: 'AMedia', creators: [{ name: 'AMedia', avatar: 'https://placehold.co/80x80/f58220/ffffff?text=A' }], content: '180 Photos, 5 Videos', schedule: 'Nov 10, 2025 10:00 AM' },
                                ] }
                            ]
                        }
                    ]
                },
                // New folders as requested
                {
                    id: 'promotional',
                    name: 'Promotional Material',
                    status: 'Public',
                    owner: 'Bachata Sensual Events',
                    creators: [{ name: 'Bachata Sensual Events', avatar: 'https://placehold.co/80x80/f58220/ffffff?text=B' }],
                    type: 'gallery',
                    content: '4 Photos',
                    children: [] // No child folders inside a gallery
                },
                {
                    id: 'demos',
                    name: 'Demos',
                    status: 'Private',
                    owner: 'AMedia',
                    creators: [{ name: 'AMedia', avatar: 'https://placehold.co/80x80/f58220/ffffff?text=A' }],
                    children: [],
                    linkAccess: true // Added new property for "Anyone with the link"
                }
            ]
        };
        // Set the current path to point to the new top-level
        let currentPath = ['sensuality'];

        function findNodeByPath(path) {
            let currentNode = galleryData;
            for (let i = 0; i < path.length; i++) {
                if (!currentNode.children) return null;
                currentNode = currentNode.children.find(c => c.id === path[i]);
            }
            return currentNode;
        }

        function renderTreeView(node, parentPath = []) {
            const li = document.createElement('li');
            li.className = 'tree-item';
            li.dataset.id = node.id;

            const currentFullPath = [...parentPath, node.id];
            const hasChildren = node.children && node.children.length > 0;
            const isActive = currentPath.join('/') === currentFullPath.join('/');

            li.innerHTML = `
                <div onclick='selectFolder(${JSON.stringify(currentFullPath)})' class="flex items-center p-1 rounded-md cursor-pointer ${isActive ? 'bg-blue-100' : 'hover:bg-gray-200'}">
                    ${hasChildren ? `<svg class="w-4 h-4 mr-1 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>` : '<div class="w-4 h-4 mr-1"></div>'}
                    <span class="font-semibold ${isActive ? 'revelo-blue' : ''}">${node.name}</span>
                </div>
            `;

            if (hasChildren) {
                const ul = document.createElement('ul');
                ul.className = 'tree-content ml-4';
                node.children.forEach(child => {
                    ul.appendChild(renderTreeView(child, currentFullPath));
                });
                li.appendChild(ul);
            }
            return li;
        }

        function renderBreadcrumbs() {
            const nav = document.getElementById('breadcrumb-nav');
            nav.innerHTML = '';
            let tempPath = [];
            currentPath.forEach((nodeId, index) => {
                tempPath.push(nodeId);
                const node = findNodeByPath([...tempPath]);
                const isLast = index === currentPath.length - 1;
                
                const crumbEl = document.createElement(isLast ? 'span' : 'a');
                crumbEl.textContent = node.name;
                
                if (isLast) {
                    crumbEl.className = 'font-semibold text-gray-800';
                } else {
                    const pathSlice = currentPath.slice(0, index + 1);
                    crumbEl.className = 'hover:underline cursor-pointer';
                    crumbEl.onclick = () => selectFolder(pathSlice);
                }
                nav.appendChild(crumbEl);
                if (!isLast) nav.append(' > ');
            });
        }

        function getStatusHtml(status) {
            switch(status) {
                case 'Approval Needed': return `<span class="text-xs font-bold bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full whitespace-nowrap">${status}</span>`;
                case 'Public': return `<span class="text-xs font-bold bg-green-100 text-green-800 px-2 py-1 rounded-full whitespace-nowrap">${status}</span>`;
                case 'Scheduled': return `<span class="text-xs font-bold bg-blue-100 text-blue-800 px-2 py-1 rounded-full whitespace-nowrap">${status}</span>`;
                default: return `<span class="text-xs font-bold bg-gray-200 text-gray-800 px-2 py-1 rounded-full whitespace-nowrap">${status}</span>`;
            }
        }
        
        // New function to generate the owner badge HTML
        function getOwnerHtml(ownerName) {
            // Updated styling to be an outline and regular font
            return `<span class="text-xs font-normal border border-revelo-blue text-revelo-blue px-2 py-1 rounded-full whitespace-nowrap">Owner: ${ownerName}</span>`;
        }

        function renderCurrentFolderActions() {
            const actionsContainer = document.getElementById('current-folder-actions');
            const currentNode = findNodeByPath(currentPath);
            const statusHtml = getStatusHtml(currentNode.status);
            // Owner badge is shown here
            const ownerHtml = currentNode.owner ? getOwnerHtml(currentNode.owner) : '';
            const linkAccessHtml = currentNode.linkAccess ? `<span class="text-xs font-bold bg-purple-100 text-purple-800 px-2 py-1 rounded-full whitespace-nowrap">Anyone with the link</span>` : '';


            let creatorsHtml = '';
            if (currentNode.creators && currentNode.creators.length > 0) {
                creatorsHtml += '<div class="flex items-center mt-2"><span class="text-sm font-semibold text-gray-600 mr-2">Media Creators:</span><div class="flex items-center space-x-2">';
                currentNode.creators.forEach(creator => {
                    creatorsHtml += `<div class="flex items-center"><img class="w-8 h-8 rounded-full border-2 border-white" src="${creator.avatar}" alt="${creator.name}" title="${creator.name}"><span class="text-sm font-semibold text-gray-700 ml-1">${creator.name}</span></div>`;
                });
                creatorsHtml += '</div></div>';
            }

            actionsContainer.innerHTML = `
                <div class="flex flex-col sm:flex-row justify-between sm:items-center">
                    <div class="flex-1 space-y-2">
                        <h3 class="font-bold text-lg revelo-blue">${currentNode.name}</h3>
                        <div class="flex flex-wrap items-center space-x-2">
                            ${statusHtml}
                            ${ownerHtml}
                            ${linkAccessHtml}
                            ${currentNode.schedule ? `<p class="text-xs text-gray-500">Publishes on ${currentNode.schedule}</p>` : ''}
                        </div>
                        ${creatorsHtml}
                    </div>
                    <div class="mt-4 sm:mt-0">
                        <button onclick="openModal('edit-folder-modal')" class="px-3 py-2 text-sm font-semibold bg-gray-200 text-gray-700 rounded-lg">Edit Folder</button>
                    </div>
                </div>
            `;
        }

        function renderGridView() {
            const grid = document.getElementById('gallery-grid');
            grid.innerHTML = '';
            const currentNode = findNodeByPath(currentPath);
            
            // Reset grid classes first
            grid.className = 'grid gap-4';

            if (currentNode.type === 'gallery') {
                grid.classList.add('grid-cols-2', 'sm:grid-cols-3', 'lg:grid-cols-5', 'xl:grid-cols-6');
                renderPhotoGalleryView(grid, currentNode);
                return;
            }
            
            grid.classList.add('grid-cols-1', 'sm:grid-cols-2', 'lg:grid-cols-3', 'xl:grid-cols-4');

            if (!currentNode.children || currentNode.children.length === 0) {
                grid.innerHTML = '<p class="text-gray-500 col-span-full">This folder is empty.</p>';
                return;
            }
            // If we are at the root level, render all children
            if (currentPath.length === 1 && currentPath[0] === 'root') {
                 currentNode.children.forEach(child => {
                     const fullPath = [child.id];
                     if (child.type === 'gallery') {
                         grid.innerHTML += createGalleryCard(child, fullPath);
                     } else {
                         grid.innerHTML += createFolderCard(child, fullPath);
                     }
                 });
             } else {
                 currentNode.children.forEach(child => {
                     const fullPath = [...currentPath, child.id];
                     if (child.type === 'gallery') {
                         grid.innerHTML += createGalleryCard(child, fullPath);
                     } else {
                         grid.innerHTML += createFolderCard(child, fullPath);
                     }
                 });
             }
        }

        function renderPhotoGalleryView(gridContainer, galleryNode) {
            let photoPaths = [];
            
            // Conditional check for promotional material gallery
            if (galleryNode.id === 'promotional') {
                photoPaths = [
                    "albums/promo/promo1.jpg",
                    "albums/promo/promo2.jpg",
                    "albums/promo/promo3.jpg",
                    "albums/promo/promo4.jpg"
                ];
            } else if (galleryNode.id === 'Social') {
                // Re-added the original 10 images for the "Social" gallery
                photoPaths = [
                    "albums/event/gallery1.jpg",
                    "albums/event/gallery2.jpg",
                    "albums/event/gallery3.jpg",
                    "albums/event/gallery4.jpg",
                    "albums/event/gallery5.jpg",
                    "albums/event/gallery6.jpg",
                    "albums/event/gallery7.jpg",
                    "albums/event/gallery8.jpg",
                    "albums/event/gallery9.jpg",
                    "albums/event/gallery10.jpg"
                ];
            } else {
                 // Fallback to placeholders for any other gallery
                 photoPaths = [
                    "https://placehold.co/600x400/cccccc/ffffff?text=Image+1",
                    "https://placehold.co/600x400/cccccc/ffffff?text=Image+2",
                    "https://placehold.co/600x400/cccccc/ffffff?text=Image+3",
                    "https://placehold.co/600x400/cccccc/ffffff?text=Image+4",
                    "https://placehold.co/600x400/cccccc/ffffff?text=Image+5",
                    "https://placehold.co/600x400/cccccc/ffffff?text=Image+6",
                    "https://placehold.co/600x400/cccccc/ffffff?text=Image+7",
                    "https://placehold.co/600x400/cccccc/ffffff?text=Image+8",
                    "https://placehold.co/600x400/cccccc/ffffff?text=Image+9",
                    "https://placehold.co/600x400/cccccc/ffffff?text=Image+10"
                ];
            }

            photoPaths.forEach(path => {
                gridContainer.innerHTML += `
                    <div class="aspect-square bg-gray-200 rounded-lg overflow-hidden" data-open-media-modal data-event="${galleryNode.name}" data-creator="AMedia">
                        <img src="${path}" class="w-full h-full object-cover cursor-pointer">
                    </div>
                `;
            });
        }

        function createFolderCard(node, path) {
            const statusHtml = getStatusHtml(node.status);
            // Owner badge is hidden in subfolder cards, but shown for top-level
            const ownerHtml = path.length === 1 ? getOwnerHtml(node.owner) : '';
            const linkAccessHtml = node.linkAccess ? `<span class="text-xs font-bold bg-purple-100 text-purple-800 px-2 py-1 rounded-full whitespace-nowrap">Anyone with the link</span>` : '';

            let creatorsHtml = '';
            if (node.creators && node.creators.length > 0) {
                creatorsHtml += '<div class="flex -space-x-2 mt-2">';
                node.creators.forEach(creator => {
                    creatorsHtml += `<img class="w-6 h-6 rounded-full border-2 border-white" src="${creator.avatar}" alt="${creator.name}" title="${creator.name}">`;
                });
                creatorsHtml += '</div>';
            }

            return `
                <div class="bg-white rounded-lg shadow border flex flex-col justify-between">
                    <div onclick='selectFolder(${JSON.stringify(path)})' class="p-4 flex items-start cursor-pointer">
                        <svg class="w-12 h-12 text-revelo-blue mr-4 flex-shrink-0" fill="currentColor" viewBox="0 0 0 20 20"><path d="M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"></path></svg>
                        <div class="space-y-1 flex-1 min-w-0">
                            <h3 class="font-bold text-lg revelo-blue truncate">${node.name}</h3>
                            <div class="flex flex-wrap items-center space-x-2">
                                ${statusHtml}
                                ${ownerHtml}
                                ${linkAccessHtml}
                            </div>
                        </div>
                    </div>
                    <div class="p-4 border-t flex justify-between items-center min-h-[60px]">
                        ${creatorsHtml || '<div></div>'}
                        ${node.schedule ? `<p class="text-xs text-gray-500 text-right">Publishes on<br>${node.schedule}</p>` : ''}
                    </div>
                </div>`;
        }

        function createGalleryCard(gallery, path) {
            const statusHtml = getStatusHtml(gallery.status);
            // Owner badge is hidden in subfolder cards, but shown for top-level
            const ownerHtml = path.length === 1 ? getOwnerHtml(gallery.owner) : '';
            const linkAccessHtml = gallery.linkAccess ? `<span class="text-xs font-bold bg-purple-100 text-purple-800 px-2 py-1 rounded-full whitespace-nowrap">Anyone with the link</span>` : '';
            
            let creatorsHtml = '';
            if (gallery.creators && gallery.creators.length > 0) {
                creatorsHtml += '<div class="flex -space-x-2">';
                gallery.creators.forEach(creator => {
                    creatorsHtml += `<img class="w-6 h-6 rounded-full border-2 border-white" src="${creator.avatar}" alt="${creator.name}" title="${creator.name}">`;
                });
                creatorsHtml += '</div>';
            }

            return `
                <div class="bg-white rounded-lg shadow border flex flex-col justify-between">
                    <div onclick='selectFolder(${JSON.stringify(path)})' class="cursor-pointer">
                        <div class="block relative group"><img src="https://placehold.co/600x400/cccccc/ffffff?text=${gallery.name.replace(' ', '+')}" alt="Gallery cover" class="w-full h-40 object-cover rounded-t-lg"></div>
                        <div class="p-4">
                            <div class="flex flex-wrap justify-between items-start space-y-1">
                                <h3 class="font-bold revelo-blue">${gallery.name}</h3>
                                <div class="flex items-center space-x-1">
                                    ${statusHtml}
                                    ${ownerHtml}
                                    ${linkAccessHtml}
                                </div>
                            </div>
                            <p class="text-sm text-gray-500">by ${gallery.creators.map(c => c.name).join(', ')}</p>
                            <p class="text-sm text-gray-500 mt-2">${gallery.content}</p>
                        </div>
                    </div>
                     <div class="p-4 border-t flex justify-between items-center min-h-[60px]">
                        ${creatorsHtml || '<div></div>'}
                        ${gallery.schedule ? `<p class="text-xs text-gray-500 text-right">Publishes on<br>${gallery.schedule}</p>` : ''}
                    </div>
                </div>`;
        }

        function selectFolder(path) {
            currentPath = path;
            updateUI();
        }
        
        function updateUI() {
            const treeContainer = document.getElementById('gallery-tree');
            treeContainer.innerHTML = '';
            // Render the top-level folders
            galleryData.children.forEach(child => {
                treeContainer.appendChild(renderTreeView(child));
            });
            
            let path = [];
            currentPath.forEach(nodeId => {
                path.push(nodeId);
                const treeItem = treeContainer.querySelector(`.tree-item[data-id="${nodeId}"]`);
                if(treeItem) treeItem.classList.add('open');
            });

            renderBreadcrumbs();
            renderCurrentFolderActions();
            renderGridView();
        }

        // --- Modal Logic ---
        const modalBackdrop = document.getElementById('modal-backdrop');
        const allModals = document.querySelectorAll('.modal');
        let modalCurrentNode = null;

        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            
            if (modalId === 'edit-folder-modal') {
                modalCurrentNode = findNodeByPath(currentPath);
                document.getElementById('modal-folder-name').textContent = `Edit Folder: ${modalCurrentNode.name}`;
                document.getElementById('modal-folder-status').value = modalCurrentNode.status;
                document.getElementById('modal-owner-name').textContent = `Folder Owner: ${modalCurrentNode.owner}`;
                renderModalCollaborators();
                toggleScheduledFields();
                toggleVisibilityControl();

                // Set the correct value for the gallery visibility dropdown
                if (modalCurrentNode.linkAccess) {
                    document.getElementById('modal-visibility-control').value = 'Anyone with the link';
                } else {
                    document.getElementById('modal-visibility-control').value = 'Restricted (only owner and collaborators)';
                }
            }

            modal.classList.remove('hidden');
            modalBackdrop.classList.remove('hidden');
        }

        function closeAllModals() {
            allModals.forEach(modal => modal.classList.add('hidden'));
            modalBackdrop.classList.add('hidden');
        }
        
        function toggleScheduledFields() {
            const status = document.getElementById('modal-folder-status').value;
            const fields = document.getElementById('modal-scheduled-fields');
            fields.classList.toggle('hidden', status !== 'Scheduled');
        }

        // New function to show/hide visibility control
        function toggleVisibilityControl() {
            const status = document.getElementById('modal-folder-status').value;
            const visibilityControl = document.getElementById('visibility-control-container');
            visibilityControl.classList.toggle('hidden', status !== 'Private');
        }

        function renderModalCollaborators() {
            const list = document.getElementById('modal-collaborators-list');
            list.innerHTML = '';
            modalCurrentNode.creators.forEach(creator => {
                const tag = document.createElement('div');
                tag.className = 'inline-flex items-center bg-gray-100 rounded-full pl-3 pr-1 py-1 text-sm font-semibold text-gray-800 border';
                tag.innerHTML = `
                    <span>${creator.name}</span>
                    <button onclick="removeModalCollaborator('${creator.name}')" class="ml-2 text-red-500 hover:text-red-700 font-bold">&times;</button>
                `;
                list.appendChild(tag);
            });
        }

        function removeModalCollaborator(name) {
            modalCurrentNode.creators = modalCurrentNode.creators.filter(c => c.name !== name);
            renderModalCollaborators();
        }

        function handleModalSearch(event) {
            const query = event.target.value.toLowerCase();
            const suggestionsContainer = document.getElementById('modal-search-suggestions');
            suggestionsContainer.innerHTML = '';
            if (query.length < 2) {
                suggestionsContainer.classList.add('hidden');
                return;
            }
            const mockResults = [{ name: 'Visuals Pro', avatar: '#' }, { name: 'Sha Iborra', avatar: '#' }];
            mockResults.forEach(res => {
                if (res.name.toLowerCase().includes(query)) {
                    const item = document.createElement('div');
                    item.className = 'p-2 hover:bg-gray-100 cursor-pointer';
                    item.textContent = res.name;
                    item.onclick = () => {
                        if (!modalCurrentNode.creators.find(c => c.name === res.name)) {
                            modalCurrentNode.creators.push(res);
                        }
                        renderModalCollaborators();
                        suggestionsContainer.classList.add('hidden');
                        event.target.value = '';
                    };
                    suggestionsContainer.appendChild(item);
                }
            });
            suggestionsContainer.classList.remove('hidden');
        }
    
        // Initialize the page on load
        document.addEventListener('DOMContentLoaded', () => {
            updateUI();
        });
    </script>
    <script src="organizer.js" defer></script>

        <!-- Media Modal -->
    <div id="media-modal" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-4 hidden z-[100]">
        <!-- Image Display Area -->
        <div class="relative w-full h-full flex items-center justify-center">
            <img id="modal-image" src="" class="max-h-full max-w-full object-contain cursor-pointer">
            
            <!-- Overlay Container -->
            <div id="modal-overlay" class="absolute inset-0 flex flex-col justify-between p-2">
                <!-- Modal Header -->
                <div class="w-full flex justify-between items-start text-white">
                    <div>
                        <h3 id="modal-event-name" class="font-bold text-lg"></h3>
                        <p id="modal-creator-name" class="text-sm"></p>
                    </div>
                    <div id="modal-header-icons" class="flex items-center space-x-2">
                        <!-- Icons will be dynamically loaded by JS -->
                    </div>
                </div>
                <!-- Navigation -->
                <div id="modal-nav" class="w-full flex justify-between items-center absolute top-1/2 left-0 transform -translate-y-1/2">
                     <button id="prev-media" class="text-white bg-black bg-opacity-30 p-3 rounded-full m-2 hover:bg-opacity-50 transition-opacity"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button>
                     <button id="next-media" class="text-white bg-black bg-opacity-30 p-3 rounded-full m-2 hover:bg-opacity-50 transition-opacity"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
