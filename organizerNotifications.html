<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revelti - Organizer Notifications</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Nunito -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
</head>
<body class="antialiased text-gray-800">
    <div id="organizer-navbar-placeholder"></div>

    <!-- Main container -->
    <div class="max-w-2xl md:max-w-full lg:max-w-full mx-auto bg-white shadow-lg flex flex-col h-full full-height-modal">

        <!-- Header Section -->
        <header class="p-6 flex items-center justify-between">
            <h1 class="text-xl font-bold revelti-blue">Organizer Notifications</h1>
            <div class="flex items-center space-x-0 flex-shrink-0">
                <!-- Settings Access Button -->
                <a href="organizerNotificationSettings.html" class="p-1.5 rounded-full hover:bg-gray-200" title="Organizer Notification Settings">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                </a>
            </div>
        </header>
        
        <!-- Tab Navigation -->
        <nav class="sticky top-12 flex-shrink-0 bg-white z-40 border-b border-gray-200">
            <div class="flex justify-around">
                <button data-tab-target="all" class="tab-button flex-1 py-3 px-1 text-center text-gray-500 hover:revelti-blue transition duration-300">All</button>
                <button data-tab-target="salesPromoters" class="tab-button flex-1 py-3 px-1 text-center text-gray-500 hover:revelti-blue transition duration-300">Sales & Promoters</button>
                <button data-tab-target="eventMedia" class="tab-button flex-1 py-3 px-1 text-center text-gray-500 hover:revelti-blue transition duration-300">Event & Media</button>
                <button data-tab-target="systemAccount" class="tab-button flex-1 py-3 px-1 text-center text-gray-500 hover:revelti-blue transition duration-300">System & Account</button>
            </div>
        </nav>

        <!-- Main Content Sections (Tabs) -->
        <main class="p-4 bg-gray-50 overflow-y-auto">
            <!-- All Tab -->
            <div id="all" class="tab-content">
                <div class="text-right mb-4">
                    <button data-mark-all="all" class="text-sm font-semibold revelti-blue hover:underline">Mark all as read</button>
                </div>
                <div class="space-y-4"></div>
            </div>

            <!-- Sales & Promoters Tab -->
            <div id="salesPromoters" class="tab-content hidden">
                 <div class="text-right mb-4">
                    <button data-mark-all="salesPromoters" class="text-sm font-semibold revelti-blue hover:underline">Mark all as read</button>
                </div>
                <div class="space-y-4"></div>
            </div>

            <!-- Event & Media Tab -->
            <div id="eventMedia" class="tab-content hidden">
                 <div class="text-right mb-4">
                    <button data-mark-all="eventMedia" class="text-sm font-semibold revelti-blue hover:underline">Mark all as read</button>
                </div>
                <div class="space-y-4"></div>
            </div>

            <!-- System & Account Tab -->
            <div id="systemAccount" class="tab-content hidden">
                 <div class="text-right mb-4">
                    <button data-mark-all="systemAccount" class="text-sm font-semibold revelti-blue hover:underline">Mark all as read</button>
                </div>
                <div class="space-y-4"></div>
            </div>
        </main>
    </div>

    <script>
    function initializeNotificationComponent(notificationHost) {
        if (!notificationHost) return;

        const tabButtons = notificationHost.querySelectorAll('.tab-button');
        const tabContents = notificationHost.querySelectorAll('.tab-content');
        const settingsButton = notificationHost.querySelector('#settings-icon-button');

        // NEW: Add logic for the settings button
        if (settingsButton) {
            settingsButton.addEventListener('click', () => {
                // Check if this component is running inside a modal
                const isInsideModal = notificationHost.closest('.modal-content');

                if (isInsideModal) {
                    // If it's a modal, close this one and open the settings modal
                    if (typeof closeModal === 'function' && typeof openSettingsModal === 'function') {
                        closeModal('notifications-modal-overlay');
                        openSettingsModal();
                    } else {
                        console.error('Modal functions are not available.');
                    }
                } else {
                    // If it's a standalone page, just navigate to the settings page
                    window.location.href = 'organizerNotificationSettings.html';
                }
            });
        }

        function switchTab(targetId) {
            tabContents.forEach(content => content.classList.add('hidden'));
            tabButtons.forEach(button => button.classList.remove('tab-active'));
            const targetContent = notificationHost.querySelector(`#${targetId}`);
            if (targetContent) targetContent.classList.remove('hidden');
            const targetButton = notificationHost.querySelector(`[data-tab-target="${targetId}"]`);
            if (targetButton) targetButton.classList.add('tab-active');
        }

        function createNotificationItem(notification) {
            const unreadIndicator = notification.read ? '' : '<div class="absolute -left-1 top-1/2 -translate-y-1/2 w-2 h-2 bg-revelti-orange rounded-full"></div>';
            const avatarSrc = notification.avatar || 'https://placehold.co/40x40/cccccc/ffffff?text=S';
            const isLink = notification.link;
            const sanitizedMessage = isLink ? notification.message.replace(/<[^>]*>/g, '').replace(/"/g, '&quot;') : '';
            const linkOverlay = isLink ? `<a href="${notification.link}" class="absolute inset-0 z-10" aria-label="${sanitizedMessage}"></a>` : '';
            const hoverClasses = isLink ? 'group hover:bg-gray-50 transition' : '';
            return `
                <div class="flex items-start p-3 bg-white rounded-lg shadow-sm relative notification-item ${hoverClasses}" data-id="${notification.id}">
                    ${linkOverlay}
                    ${unreadIndicator}
                    <img src="${avatarSrc}" onerror="this.onerror=null;this.src='https://placehold.co/40x40/cccccc/ffffff?text=N';" alt="${notification.type} Icon" class="w-10 h-10 rounded-full object-cover shadow-md mr-3">
                    <div class="flex-1">
                        <p class="text-sm leading-snug group-hover:text-revelti-blue">${notification.message}</p>
                        <p class="text-xs text-gray-500 mt-1">${notification.timestamp}</p>
                    </div>
                    <div class="relative z-20">
                        <button class="p-1 rounded-full hover:bg-gray-100 text-gray-400 ml-2 context-menu-button" title="More options">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"></path></svg>
                        </button>
                        <div class="absolute top-0 right-8 w-48 bg-white border border-gray-200 rounded-lg shadow-lg p-2 z-50 hidden context-menu">
                            <button data-mark-one="${notification.id}" class="block w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100">Mark read</button>
                            <button class="block w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100">Mute notifications</button>
                            <button class="block w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100">Hide this</button>
                            <button class="block w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100">Report</button>
                        </div>
                    </div>
                </div>`;
        }

        let notificationsData = [
            // Sales & Promoters
            { id: 1, type: 'salesPromoters', message: 'Congratulations! You\'ve sold <strong>100 tickets</strong> for <strong>Bachata Geneva Festival 2026 - The Festival of Nations</strong>.', timestamp: '1h ago', avatar: 'images/organizerAvatar.png', read: false, link: 'eventBreakdown.html' },
            { id: 2, type: 'salesPromoters', message: 'Your promoter <strong>John Doe</strong> has reached the <strong>Gold Tier</strong> by selling <strong>50 tickets</strong> for your event <strong>Bachata Geneva Festival 2026 - The Festival of Nations</strong>.', timestamp: '3h ago', avatar: 'https://placehold.co/40x40/cccccc/000000?text=JD', read: true, link: 'eventCollaboratorManagement.html' },
            { id: 3, type: 'salesPromoters', message: 'Your event page for <strong>Bachata Geneva Festival 2026 - The Festival of Nations</strong> has received <strong>1,000 views</strong> this week.', timestamp: '2 days ago', avatar: 'images/organizerAvatar.png', read: false, link: '#' },
            { id: 4, type: 'salesPromoters', message: 'Your payment of <strong>€2,500</strong> for ticket sales has been sent to your bank account.', timestamp: '5m ago', avatar: 'https://placehold.co/40x40/213c63/ffffff?text=€', read: false, link: 'financialOverview.html' },
            { id: 5, type: 'salesPromoters', message: 'A refund request for ticket <strong>#12345</strong> has been submitted for <strong>Bachata Geneva Festival 2026 - The Festival of Nations</strong>.', timestamp: '1 day ago', avatar: 'https://placehold.co/40x40/213c63/ffffff?text=R', read: true, link: 'financialOverview.html' },

            // Event & Media
            { id: 6, type: 'eventMedia', message: '<strong>AMedia</strong> has published a new gallery for your event: <strong>Workshops - Day 1</strong>.', timestamp: '10m ago', avatar: 'https://placehold.co/40x40/f58220/ffffff?text=A', read: false, link: 'mediaManagement.html' },
            { id: 7, type: 'eventMedia', message: '<strong>Lutty Moreira</strong> have accepted your invitation to be a collaborator for <strong>Bachata Geneva Festival 2026 - The Festival of Nations</strong>.', timestamp: '30m ago', avatar: 'https://placehold.co/40x40/213c63/ffffff?text=A', read: false, link: 'eventCollaboratorManagement.html' },
            { id: 8, type: 'eventMedia', message: 'A new question from an attendee has been posted on your event\'s FAQ page.', timestamp: '2h ago', avatar: 'https://placehold.co/40x40/213c63/ffffff?text=?', read: true, link: '#' },

            // System & Account
            { id: 9, type: 'systemAccount', message: 'Welcome to Revelti, <strong>Bachata Geneva</strong>! Start by creating a new event or inviting collaborators.', timestamp: '15m ago', avatar: 'https://placehold.co/40x40/cccccc/ffffff?text=S', read: false, link: '#' },
            { id: 10, type: 'systemAccount', message: 'New Feature Alert! You can now use the <strong>Advanced Analytics Dashboard</strong> to track your sales in real-time.', timestamp: '1 day ago', avatar: 'https://placehold.co/40x40/cccccc/ffffff?text=F', read: false, link: 'ticketBreakdown.html' },
            { id: 11, type: 'systemAccount', message: 'Your password was successfully updated. If this wasn\'t you, please contact support immediately.', timestamp: '4 days ago', avatar: 'https://placehold.co/40x40/cccccc/ffffff?text=S', read: true, link: '#' }
        ];

        function parseTimestamp(timestampStr) { const lowerCaseStr = timestampStr.toLowerCase(); if (lowerCaseStr === 'yesterday') return 1440; const num = parseInt(lowerCaseStr, 10); if (isNaN(num)) return Infinity; if (lowerCaseStr.includes('week')) return num * 10080; if (lowerCaseStr.includes('day')) return num * 1440; if (lowerCaseStr.includes('h')) return num * 60; if (lowerCaseStr.includes('m')) return num; return Infinity; }
        function markOneAsRead(id) { const notification = notificationsData.find(n => n.id === id); if (notification) { notification.read = true; renderNotifications(); } }
        function markAllAsRead(category = 'all') { notificationsData.forEach(n => { if (category === 'all' || n.type === category) n.read = true; }); renderNotifications(); }

        function renderNotifications() {
            const tabs = { all: '', salesPromoters: '', eventMedia: '', systemAccount: '' };
            const sorted = [...notificationsData].sort((a, b) => parseTimestamp(a.timestamp) - parseTimestamp(b.timestamp));
            sorted.forEach(n => {
                const itemHtml = createNotificationItem(n);
                tabs.all += itemHtml;
                if (tabs.hasOwnProperty(n.type)) tabs[n.type] += itemHtml;
            });
            for (const key in tabs) {
                const container = notificationHost.querySelector(`#${key} .space-y-4`);
                if (container) container.innerHTML = tabs[key];
            }
        }

        tabButtons.forEach(button => button.addEventListener('click', () => switchTab(button.dataset.tabTarget)));
        notificationHost.querySelectorAll('[data-mark-all]').forEach(button => button.addEventListener('click', () => markAllAsRead(button.dataset.markAll)));
        notificationHost.addEventListener('click', (event) => {
            const contextButton = event.target.closest('.context-menu-button');
            if (contextButton) {
                event.stopPropagation();
                const menu = contextButton.closest('.relative').querySelector('.context-menu');
                notificationHost.querySelectorAll('.context-menu').forEach(m => { if (m !== menu) m.classList.add('hidden'); });
                menu.classList.toggle('hidden');
                return;
            }
            const markOneButton = event.target.closest('[data-mark-one]');
            if (markOneButton) {
                markOneAsRead(parseInt(markOneButton.dataset.markOne, 10));
                return;
            }
            if (!event.target.closest('.context-menu')) {
                notificationHost.querySelectorAll('.context-menu').forEach(m => m.classList.add('hidden'));
            }
        });

        switchTab('all');
        renderNotifications();
    }

    document.addEventListener('DOMContentLoaded', () => {
        const pageHost = document.querySelector('.max-w-2xl.mx-auto.bg-white');
        if (pageHost) {
            initializeNotificationComponent(pageHost);
        }
    });
    </script>
    <script src="organizer.js" defer></script>
    <div id="footer-placeholder"></div>
</body>
</html>
